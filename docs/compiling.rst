.. _compiling:

===========================================
编译
===========================================

**sCrypt IDE** 支持在代码编辑器/资源管理器上下文菜单中编译合约文件。

.. image:: ./images/compiling.gif
    :width: 100%

编译完成后，在vscode 窗口的右下角会有 **通知** ，同时 **输出面板** 也会输出编译结果，包括编译的合约文件名，编译出来的脚本大小 [1]_， 合约描述文件存放路径。


.. _contractdescription:

合约描述文件
===========================================


合约描述文件（ * *_desc.json* 文件）是编译合约的输出结果，可用于测试合约、部署、调用和集成合约。
这是一个示例合约描述文件 desc_。

主要字段说明


===============     ======================================================================================
字段                说明
===============     ======================================================================================
version             合约描述文件版本号，版本修改记录 VERSIONLOG_
compilerVersion     编译合约时使用的 sCrypt 编译器版本号
contract            合约名称
md5                 合约源代码 md5
buildTypes          合约描述文件的构建类型 ``debug`` 或者 ``release``
structs             合约中定义的结构体
alias               合约中定义的别名
abi                 合约接口，合约中所有 ``public`` 方法的描述
file                合约源代码路径
asm                 合约编译出来的比特币脚本
sources             合约包含的所有源代码
sourceMap           sourceMap 主要用于 debug 调试，发布编译没有sourceMap信息， 调试编译才有内容
===============     ======================================================================================


.. _debug_compiling:

调试编译
===========================================

*在代码编辑器上右键单击，选择* : ``Compile to Bitcoin Script : Debug``

在开发过程中我们主要使用调试编译来构建合约，包括调试器、单元测试，甚至部署调用合约也使用此构建类型。在该构建类型下，
编译器生成的脚本可能包含辅助信息，不包含优化，编译结果包含 ``sourceMap``， 可以用于调试定位异常。

.. _release_compiling:

发布编译
===========================================

*在代码编辑器上右键单击，选择* : ``Compile to Bitcoin Script : Release``

当一切准备就绪之后，我们应该使用发布编译来构建你的合约。在该构建类型下，
编译器会 :ref:`优化生成 <optimize>` 的脚本，删除辅助信息，从而使脚本会变得更小，节省您的交易手续费。
目前只有我们的付费用户才能使用此功能，请参阅 :ref:`高级付费功能 <premium>`

.. warning::

    不版本的编译器编译出来的脚本可能会不一样，但是脚本是等价。如果编译出来的脚本发生变化了，通常会导致旧的的 **交易原象** 无法校验通过，通过计算一个新的 **交易原象** 即可修复此问题。



.. [1] 改大小计算方式不包含合约构造函数参数



.. _desc: https://gist.github.com/zhfnjust/026f9f4612693afc73d7e211f1a7d3f1

.. _VERSIONLOG: https://github.com/sCrypt-Inc/scryptlib/blob/master/VERSIONLOG.md